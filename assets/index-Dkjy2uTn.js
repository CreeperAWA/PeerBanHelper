const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dummyChart-Dzc6hQ0_.js","./echarts-BYHwTzLq.js","./libs-Dn3n__lQ.js","./index-BQWzli-X.js","./arcoDesign-MpQA7HAz.js","./index-DxW5NURa.css"])))=>i.map(i=>d[i]);
import{u as z,a as H,g as Q,k as X,m as he,_ as ye,f as ce,n as be}from"./index-BQWzli-X.js";import{a as w,B as E,ak as F,L as re,O as ue,F as me,G as J,av as ne,v as ge,T as _e,S as le,H as K,a7 as Y,C as M,aw as ve,c as ke,E as we,Q as De,R as xe,U as Se,ax as Ve,V as Ce}from"./arcoDesign-MpQA7HAz.js";import{u as Z,E as ee,i as te,a as de,b as fe,c as ae,d as ie,e as pe,f as Oe}from"./echarts-BYHwTzLq.js";import{f as I,a6 as $,r as P,a as oe,c as C,w as N,a8 as q,j as f,s as h,t,y as r,a2 as e,v as m,x as g,u as j,l as Te,a9 as Pe,k as Ae,P as Ue,F as Le}from"./libs-Dn3n__lQ.js";import{I as Re}from"./index-BhBCdIEf.js";import{u as Ie}from"./userStore-DsGWmcrK.js";async function $e(b,a=!1,l){const o=z();await o.serverAvailable;const n=new URLSearchParams({type:"count",field:b,filter:a?"0.01":"0"});l&&n.append("downloader",l);const _=new URL(H(o.endpoint,"api/statistic/analysis/field?"+n.toString()),location.href);return fetch(_,{headers:Q()}).then(p=>(o.assertResponseLogin(p),p.json()))}async function Ee(b,a,l,o){const n=z();await n.serverAvailable;const _=new URL(H(n.endpoint,"api/chart/geoIpInfo"),location.href),p=b.getTime(),c=a.getTime();return _.searchParams.append("startAt",p.toString()),_.searchParams.append("endAt",c.toString()),_.searchParams.append("bannedOnly",String(l)),o&&_.searchParams.append("downloader",o),fetch(_,{headers:Q()}).then(v=>(n.assertResponseLogin(v),v.json()))}async function Be(b,a,l){const o=z();await o.serverAvailable;const n=new URLSearchParams({startAt:b.getTime().toString(),endAt:a.getTime().toString()});l&&n.append("downloader",l);const _=new URL(H(o.endpoint,"api/statistic/analysis/banTrends?"+n.toString()),location.href);return fetch(_,{headers:Q()}).then(p=>(o.assertResponseLogin(p),p.json()))}async function je(b,a,l){const o=z();await o.serverAvailable;const n=new URLSearchParams({startAt:b.getTime().toString(),endAt:a.getTime().toString()});l&&n.append("downloader",l);const _=new URL(H(o.endpoint,"api/chart/trend?"+n.toString()),location.href);return fetch(_,{headers:Q()}).then(p=>(o.assertResponseLogin(p),p.json()))}async function ze(b,a,l){const o=z();await o.serverAvailable;const n=new URLSearchParams({startAt:b.getTime().toString(),endAt:a.getTime().toString()});l&&n.append("downloader",l);const _=new URL(H(o.endpoint,"api/chart/traffic?"+n.toString()),location.href);return fetch(_,{headers:Q()}).then(p=>(o.assertResponseLogin(p),p.json()))}const Fe=I({__name:"ispPie",props:{downloader:{}},setup(b){const{t:a}=$();Z([te,de,fe,ae]);const l=X(),o=P(),n=oe({field:"isp",enableThreshold:!0,bannedOnly:!0,range:[w().startOf("day").add(-14,"day").toDate(),new Date]}),_=C(()=>({text:a("page.charts.loading"),color:l.isDark?"rgb(60, 126, 255)":"rgb(22, 93, 255)",textColor:l.isDark?"rgba(255, 255, 255, 0.9)":"rgb(29, 33, 41)",maskColor:l.isDark?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"})),p=C(()=>c.value),c=P({tooltip:{trigger:"item",appendToBody:!0,formatter:'<p style="word-wrap:break-all"><b>{b}</b></p>  {c} ({d}%)',backgroundColor:l.isDark?"#333335":"",borderColor:l.isDark?"#333335":"",textStyle:{color:l.isDark?"rgba(255, 255, 255, 0.7)":""}},legend:{orient:"vertical",left:"right",type:"scroll",right:10,top:20,bottom:20,data:[],textStyle:{overflow:"truncate",width:100},tooltip:{show:!0}},backgroundColor:l.isDark?"rgba(0, 0, 0, 0.0)":void 0,series:[{name:"",type:"pie",radius:"55%",center:["50%","60%"],data:[],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]});N(n,i=>{x(i.range[0],i.range[1],n.bannedOnly,v.downloader)});const v=b,{loading:D,run:x,refresh:V}=q(Ee,{defaultParams:[w().startOf("day").add(-7,"day").toDate(),new Date,n.bannedOnly,v.downloader],onSuccess:i=>{if(i.data){const d=i.data[n.field];let s;if(n.enableThreshold){const k=d.reduce((y,T)=>y+T.value,0)*.01;s=d.filter(y=>y.value>=k)}else s=d;c.value.legend.data=s.map(u=>u.key),c.value.series[0].data=s.map(u=>({name:u.key==="N/A"&&n.field==="province"?a("page.charts.data.province.na"):u.key,value:u.value})),c.value.series[0].name=a("page.charts.options.field."+n.field)}},onError:i=>{o.value=i}});return(i,d)=>{const s=E,u=F,k=re,y=ue,T=me,S=J,A=ne,U=ge,L=_e,B=le,W=K,G=Y,R=M;return f(),h(R,{hoverable:"",title:e(a)("page.charts.title.geoip")+(n.bannedOnly?e(a)("page.charts.subtitle.bannedOnly"):"")},{extra:t(()=>[r(G,null,{content:t(()=>[r(W,{model:n},{default:t(()=>[r(S,{field:"field",label:e(a)("page.charts.options.field")},{default:t(()=>[r(T,{modelValue:n.field,"onUpdate:modelValue":d[1]||(d[1]=O=>n.field=O),"trigger-props":{autoFitPopupMinWidth:!0}},{default:t(()=>[r(y,{value:"isp"},{default:t(()=>[m(g(e(a)("page.charts.options.field.isp")),1)]),_:1}),r(y,{value:"province"},{default:t(()=>[m(g(e(a)("page.charts.options.field.province")),1)]),_:1}),r(y,{value:"city"},{default:t(()=>[m(g(e(a)("page.charts.options.field.city")),1)]),_:1}),r(y,{value:"region"},{default:t(()=>[m(g(e(a)("page.charts.options.field.region")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),r(S,{field:"range",label:e(a)("page.charts.options.days")},{default:t(()=>[r(A,{modelValue:n.range,"onUpdate:modelValue":d[2]||(d[2]=O=>n.range=O),"show-time":"","value-format":"Date",shortcuts:[{label:e(a)("page.charts.options.shortcut.7days"),value:()=>[e(w)().startOf("day").add(-7,"day").toDate(),new Date]},{label:e(a)("page.charts.options.shortcut.14days"),value:()=>[e(w)().startOf("day").add(-14,"day").toDate(),new Date]},{label:e(a)("page.charts.options.shortcut.30days"),value:()=>[e(w)().startOf("day").add(-30,"day").toDate(),new Date]}]},null,8,["modelValue","shortcuts"])]),_:1},8,["label"]),r(S,{field:"enableThreshold"},{default:t(()=>[r(B,null,{default:t(()=>[r(U,{modelValue:n.enableThreshold,"onUpdate:modelValue":d[3]||(d[3]=O=>n.enableThreshold=O)},null,8,["modelValue"]),r(L,null,{default:t(()=>[m(g(e(a)("page.charts.options.thresold")),1)]),_:1})]),_:1})]),_:1}),r(S,{field:"bannedOnly"},{default:t(()=>[r(B,null,{default:t(()=>[r(U,{modelValue:n.bannedOnly,"onUpdate:modelValue":d[4]||(d[4]=O=>n.bannedOnly=O)},null,8,["modelValue"]),r(L,null,{default:t(()=>[m(g(e(a)("page.charts.options.bannedOnly")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),default:t(()=>[r(k,null,{default:t(()=>[m(g(e(a)("page.charts.options.more")),1)]),_:1})]),_:1})]),default:t(()=>[o.value?(f(),h(u,{key:0,status:"500",title:e(a)("page.charts.error.title"),class:"chart chart-error"},{subtitle:t(()=>[m(g(o.value.message),1)]),extra:t(()=>[r(s,{type:"primary",onClick:d[0]||(d[0]=()=>{o.value=void 0,e(V)()})},{default:t(()=>[m(g(e(a)("page.charts.error.refresh")),1)]),_:1})]),_:1},8,["title"])):(f(),h(e(ee),{key:1,class:"chart",option:p.value,loading:e(D),autoresize:"","loading-options":_.value,theme:e(l).isDark?"dark":"light","init-options":{renderer:"svg"}},null,8,["option","loading","loading-options","theme"]))]),_:1},8,["title"])}}}),Me=I({__name:"banTrends",props:{downloader:{}},setup(b){const{t:a}=$(),l=C(()=>({text:a("page.charts.loading"),color:o.isDark?"rgb(60, 126, 255)":"rgb(22, 93, 255)",textColor:o.isDark?"rgba(255, 255, 255, 0.9)":"rgb(29, 33, 41)",maskColor:o.isDark?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"})),o=X(),n=P();Z([te,ie,pe,ae]);const _=b,p=oe({range:[w().startOf("day").add(-7,"day").toDate(),new Date]}),c=C(()=>v.value),v=P({xAxis:{type:"time",max:"dataMax"},yAxis:{type:"value"},tooltip:{trigger:"axis",backgroundColor:o.isDark?"#333335":"",borderColor:o.isDark?"#333335":"",textStyle:{color:o.isDark?"rgba(255, 255, 255, 0.7)":""}},grid:{left:"15%"},series:[{data:[],type:"line",name:a("page.charts.line.options.field")}],backgroundColor:o.isDark?"rgba(0, 0, 0, 0.0)":void 0});N(p,i=>{x(i.range[0],i.range[1],_.downloader)});const{loading:D,run:x,refresh:V}=q(Be,{defaultParams:[w().startOf("day").add(-7,"day").toDate(),new Date,_.downloader],onSuccess:i=>{i.data&&(v.value.series[0].data=i.data.sort((d,s)=>d.key-s.key).map(d=>[new Date(d.key),d.value]))},onError:i=>{n.value=i}});return(i,d)=>{const s=re,u=ne,k=J,y=K,T=Y,S=E,A=F,U=M;return f(),h(U,{hoverable:"",title:e(a)("page.charts.title.line")},{extra:t(()=>[r(T,null,{content:t(()=>[r(y,{model:p},{default:t(()=>[r(k,{field:"range",label:e(a)("page.charts.options.days"),"label-col-flex":"100px"},{default:t(()=>[r(u,{modelValue:p.range,"onUpdate:modelValue":d[0]||(d[0]=L=>p.range=L),"show-time":"","value-format":"Date",shortcuts:[{label:e(a)("page.charts.options.shortcut.7days"),value:()=>[e(w)().startOf("day").add(-7,"day").toDate(),new Date]},{label:e(a)("page.charts.options.shortcut.14days"),value:()=>[e(w)().startOf("day").add(-14,"day").toDate(),new Date]},{label:e(a)("page.charts.options.shortcut.30days"),value:()=>[e(w)().startOf("day").add(-30,"day").toDate(),new Date]}]},null,8,["modelValue","shortcuts"])]),_:1},8,["label"])]),_:1},8,["model"])]),default:t(()=>[r(s,null,{default:t(()=>[m(g(e(a)("page.charts.options.more")),1)]),_:1})]),_:1})]),default:t(()=>[n.value?(f(),h(A,{key:0,status:"500",title:e(a)("page.charts.error.title"),class:"chart chart-error"},{subtitle:t(()=>[m(g(n.value.message),1)]),extra:t(()=>[r(S,{type:"primary",onClick:d[1]||(d[1]=()=>{n.value=void 0,e(V)()})},{default:t(()=>[m(g(e(a)("page.charts.error.refresh")),1)]),_:1})]),_:1},8,["title"])):(f(),h(e(ee),{key:1,class:"chart",option:c.value,loading:e(D),"loading-options":l.value,theme:e(o).isDark?"dark":"ovilia-green",autoresize:"","init-options":{renderer:"svg"}},null,8,["option","loading","loading-options","theme"]))]),_:1},8,["title"])}}}),Ne=I({__name:"fieldPie",props:{downloader:{}},setup(b){const{t:a}=$();Z([te,de,fe,ae]);const l=X(),o=oe({field:"peerId",enableThreshold:!0,mergeSameVersion:!1}),n=C(()=>({text:a("page.charts.loading"),color:l.isDark?"rgb(60, 126, 255)":"rgb(22, 93, 255)",textColor:l.isDark?"rgba(255, 255, 255, 0.9)":"rgb(29, 33, 41)",maskColor:l.isDark?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"})),_=P(),p=C(()=>c.value),c=P({tooltip:{trigger:"item",appendToBody:!0,formatter:'<p style="word-wrap:break-all"><b>{b}</b></p>  {c} ({d}%)',backgroundColor:l.isDark?"#333335":"",borderColor:l.isDark?"#333335":"",textStyle:{color:l.isDark?"rgba(255, 255, 255, 0.7)":""}},legend:{orient:"vertical",left:"right",type:"scroll",right:10,top:20,bottom:20,data:[],textStyle:{overflow:"truncate",width:100},tooltip:{show:!0}},backgroundColor:l.isDark?"rgba(0, 0, 0, 0.0)":void 0,series:[{name:a("page.charts.options.field."+o.field),type:"pie",radius:"55%",center:["50%","60%"],data:[],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]});N(o,i=>{x(i.field,i.enableThreshold,v.downloader)});const v=b,{loading:D,run:x,refresh:V}=q($e,{defaultParams:["peerId",!0,v.downloader],onSuccess:i=>{if(i.data){const d=i.data.map(s=>(s.data===""&&(s.data=a("page.charts.options.field.empty")),s));if(o.mergeSameVersion&&o.field==="peerId"){const s=new Map;d.forEach(u=>{let k=u.data;const y=k.match(/^([-]?[a-zA-z]+)[0-9]+.*/);y&&(y==null?void 0:y.length)>=2&&(k=y[1]+"*"),s.has(k)?s.set(k,s.get(k)+u.count):s.set(k,u.count)}),c.value.legend.data=[],c.value.series[0].data=[],Array.from(s).forEach(([u,k])=>{c.value.legend.data.push(u),c.value.series[0].data.push({name:u,value:k})})}else c.value.legend.data=d.map(s=>s.data),c.value.series[0].data=d.map(s=>({name:s.data,value:s.count}))}},onError:i=>{_.value=i}});return(i,d)=>{const s=E,u=F,k=re,y=ue,T=me,S=J,A=ge,U=_e,L=le,B=K,W=Y,G=M;return f(),h(G,{hoverable:"",title:e(a)("page.charts.options.field."+o.field)},{extra:t(()=>[r(W,null,{content:t(()=>[r(B,{model:o,style:{width:"25vh"}},{default:t(()=>[r(S,{field:"field",label:e(a)("page.charts.options.field")},{default:t(()=>[r(T,{modelValue:o.field,"onUpdate:modelValue":d[1]||(d[1]=R=>o.field=R),"trigger-props":{autoFitPopupMinWidth:!0}},{default:t(()=>[r(y,{value:"peerId"},{default:t(()=>[m(g(e(a)("page.charts.options.field.peerId")),1)]),_:1}),r(y,{value:"torrentName"},{default:t(()=>[m(g(e(a)("page.charts.options.field.torrentName")),1)]),_:1}),r(y,{value:"module"},{default:t(()=>[m(g(e(a)("page.charts.options.field.module")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),r(S,{field:"enableThreshold"},{default:t(()=>[r(L,null,{default:t(()=>[r(A,{modelValue:o.enableThreshold,"onUpdate:modelValue":d[2]||(d[2]=R=>o.enableThreshold=R)},null,8,["modelValue"]),r(U,null,{default:t(()=>[m(g(e(a)("page.charts.options.thresold")),1)]),_:1})]),_:1})]),_:1}),o.field==="peerId"?(f(),h(S,{key:0,field:"mergeSameVersion"},{default:t(()=>[r(L,null,{default:t(()=>[r(A,{modelValue:o.mergeSameVersion,"onUpdate:modelValue":d[3]||(d[3]=R=>o.mergeSameVersion=R)},null,8,["modelValue"]),r(U,null,{default:t(()=>[m(g(e(a)("page.charts.options.mergeSame")),1)]),_:1})]),_:1})]),_:1})):j("",!0)]),_:1},8,["model"])]),default:t(()=>[r(k,null,{default:t(()=>[m(g(e(a)("page.charts.options.more")),1)]),_:1})]),_:1})]),default:t(()=>[_.value?(f(),h(u,{key:0,status:"500",title:e(a)("page.charts.error.title"),class:"chart chart-error"},{subtitle:t(()=>[m(g(_.value.message),1)]),extra:t(()=>[r(s,{type:"primary",onClick:d[0]||(d[0]=()=>{_.value=void 0,e(V)()})},{default:t(()=>[m(g(e(a)("page.charts.error.refresh")),1)]),_:1})]),_:1},8,["title"])):(f(),h(e(ee),{key:1,class:"chart",option:p.value,loading:e(D),autoresize:"","loading-options":n.value,theme:e(l).isDark?"dark":"light","init-options":{renderer:"svg"}},null,8,["option","loading","loading-options","theme"]))]),_:1},8,["title"])}}}),qe=I({__name:"plusWarpper",props:{title:{}},setup(b){const a=Pe(()=>he(()=>import("./dummyChart-Dzc6hQ0_.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),{t:l}=$(),o=z(),n=C(()=>o.plusStatus),_=()=>{o.emitter.emit("open-plus-modal")};return(p,c)=>{var i;const v=Re,D=E,x=F,V=M;return(i=n.value)!=null&&i.activated?Te(p.$slots,"default",{key:0},void 0,!0):(f(),h(V,{key:1,hoverable:"",title:p.title},{default:t(()=>[r(x,{class:"overlay",status:"warning",title:e(l)("page.charts.locked")},{icon:t(()=>[r(v)]),subtitle:t(()=>[m(g(e(l)("page.charts.locked.tips")),1)]),extra:t(()=>[r(D,{type:"primary",onClick:_},{default:t(()=>[m(g(e(l)("page.charts.locked.active")),1)]),_:1})]),_:1},8,["title"]),r(e(a))]),_:1},8,["title"]))}}}),se=ye(qe,[["__scopeId","data-v-0b577f3a"]]),We=I({__name:"traffic",props:{downloader:{}},setup(b){Z([te,de,Oe,pe,ie,ae]);const a=oe({range:[w().startOf("day").add(-14,"day").toDate(),new Date]}),l=X(),o=C(()=>({text:n("page.charts.loading"),color:l.isDark?"rgb(60, 126, 255)":"rgb(22, 93, 255)",textColor:l.isDark?"rgba(255, 255, 255, 0.9)":"rgb(29, 33, 41)",maskColor:l.isDark?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"})),{t:n,d:_}=$(),p=P(),c=C(()=>v.value),v=P({tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:l.isDark?"#333335":"",borderColor:l.isDark?"#333335":"",textStyle:{color:l.isDark?"rgba(255, 255, 255, 0.7)":""},formatter:function(s){return _(s[0].data[0],"short")+":<br/>"+s.map(u=>`${u.marker} ${u.seriesName}: ${ce(u.data[1])}`).join("<br>")}},backgroundColor:l.isDark?"rgba(0, 0, 0, 0.0)":void 0,legend:{data:[n("page.charts.traffic.options.download"),n("page.charts.traffic.options.upload")]},xAxis:{type:"time",max:"dataMax",min:"dataMin",minInterval:3600*24*1e3},grid:{left:"15%"},yAxis:{type:"value",axisLabel:{formatter:s=>ce(s)}},series:[{name:n("page.charts.traffic.options.download"),type:"line",emphasis:{focus:"series"},data:[]},{name:n("page.charts.traffic.options.upload"),type:"line",emphasis:{focus:"series"},data:[]}]});N(a,s=>{V(s.range[0],s.range[1],D.downloader)});const D=b,{loading:x,run:V,refresh:i,data:d}=q(ze,{defaultParams:[w().startOf("day").add(-7,"day").toDate(),new Date,D.downloader],onSuccess:s=>{s.data&&(v.value.series[0].data=s.data.map(u=>[new Date(u.timestamp),u.dataOverallDownloaded]),v.value.series[1].data=s.data.map(u=>[new Date(u.timestamp),u.dataOverallUploaded]))},onError:s=>{p.value=s}});return(s,u)=>{const k=re,y=ne,T=J,S=K,A=ve,U=ke,L=Y,B=E,W=F,G=we,R=M;return f(),h(R,{hoverable:"",title:e(n)("page.charts.title.traffic")},{extra:t(()=>[r(L,null,{content:t(()=>[r(S,{model:a},{default:t(()=>[r(T,{field:"range",label:e(n)("page.charts.options.days"),"label-col-flex":"100px"},{default:t(()=>[r(y,{modelValue:a.range,"onUpdate:modelValue":u[0]||(u[0]=O=>a.range=O),"show-time":"","value-format":"Date",shortcuts:[{label:e(n)("page.charts.options.shortcut.7days"),value:()=>[e(w)().startOf("day").add(-7,"day").toDate(),new Date]},{label:e(n)("page.charts.options.shortcut.14days"),value:()=>[e(w)().startOf("day").add(-14,"day").toDate(),new Date]},{label:e(n)("page.charts.options.shortcut.30days"),value:()=>[e(w)().startOf("day").add(-30,"day").toDate(),new Date]}]},null,8,["modelValue","shortcuts"])]),_:1},8,["label"])]),_:1},8,["model"])]),default:t(()=>[r(k,null,{default:t(()=>[m(g(e(n)("page.charts.options.more")),1)]),_:1}),r(U,{content:e(n)("page.charts.tooltip.traffic")},{default:t(()=>[r(A)]),_:1},8,["content"])]),_:1})]),default:t(()=>{var O;return[p.value?(f(),h(W,{key:0,status:"500",title:e(n)("page.charts.error.title"),class:"chart chart-error"},{subtitle:t(()=>[m(g(p.value.message),1)]),extra:t(()=>[r(B,{type:"primary",onClick:u[1]||(u[1]=()=>{p.value=void 0,e(i)()})},{default:t(()=>[m(g(e(n)("page.charts.error.refresh")),1)]),_:1})]),_:1},8,["title"])):!((O=e(d))!=null&&O.data)&&!e(x)?(f(),h(G,{key:1,class:"chart",style:{"align-items":"center",display:"flex","justify-content":"center","flex-direction":"column"}})):(f(),h(e(ee),{key:2,class:"chart",option:c.value,loading:e(x),"loading-options":o.value,theme:e(l).isDark?"dark":"ovilia-green",autoresize:"","init-options":{renderer:"svg"}},null,8,["option","loading","loading-options","theme"]))]}),_:1},8,["title"])}}}),Ge=I({__name:"trends",props:{downloader:{}},setup(b){Z([pe,te,ie,ae]);const{t:a}=$(),l=oe({range:[w().startOf("day").add(-14,"day").toDate(),new Date]}),o=P(),n=X(),_=C(()=>({text:a("page.charts.loading"),color:n.isDark?"rgb(60, 126, 255)":"rgb(22, 93, 255)",textColor:n.isDark?"rgba(255, 255, 255, 0.9)":"rgb(29, 33, 41)",maskColor:n.isDark?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"})),p=C(()=>c.value),c=P({xAxis:{type:"time",max:"dataMax"},yAxis:{type:"value"},tooltip:{trigger:"axis",backgroundColor:n.isDark?"#333335":"",borderColor:n.isDark?"#333335":"",textStyle:{color:n.isDark?"rgba(255, 255, 255, 0.7)":""}},backgroundColor:n.isDark?"rgba(0, 0, 0, 0.0)":void 0,series:[{data:[],type:"line",color:"#A5A051",areaStyle:{color:"#A5A051"},name:a("page.charts.trends.options.peers")},{data:[],type:"line",color:"#DB4D6D",areaStyle:{color:"#DB4D6D"},name:a("page.charts.trends.options.bans")}]});N(l,i=>{x(i.range[0],i.range[1],v.downloader)});const v=b,{loading:D,run:x,refresh:V}=q(je,{defaultParams:[w().startOf("day").add(-7,"day").toDate(),new Date,v.downloader],onSuccess:i=>{i.data&&(c.value.series[0].data=i.data.connectedPeersTrend.sort((d,s)=>d.key-s.key).map(d=>[new Date(d.key),d.value]),c.value.series[1].data=i.data.bannedPeersTrend.sort((d,s)=>d.key-s.key).map(d=>[new Date(d.key),d.value]))},onError:i=>{o.value=i}});return(i,d)=>{const s=ne,u=J,k=K,y=E,T=F,S=M;return f(),h(S,{hoverable:"",title:e(a)("page.charts.title.trends")},{extra:t(()=>[r(k,{model:l,"auto-label-width":""},{default:t(()=>[r(u,{field:"range",label:e(a)("page.charts.options.days"),style:{"margin-bottom":"0"}},{default:t(()=>[r(s,{modelValue:l.range,"onUpdate:modelValue":d[0]||(d[0]=A=>l.range=A),"value-format":"Date",style:{width:"275px"},shortcuts:[{label:e(a)("page.charts.options.shortcut.7days"),value:()=>[e(w)().startOf("day").add(-7,"day").toDate(),new Date]},{label:e(a)("page.charts.options.shortcut.14days"),value:()=>[e(w)().startOf("day").add(-14,"day").toDate(),new Date]},{label:e(a)("page.charts.options.shortcut.30days"),value:()=>[e(w)().startOf("day").add(-30,"day").toDate(),new Date]}]},null,8,["modelValue","shortcuts"])]),_:1},8,["label"])]),_:1},8,["model"])]),default:t(()=>[o.value?(f(),h(T,{key:0,status:"500",title:e(a)("page.charts.error.title"),class:"chart chart-error"},{subtitle:t(()=>[m(g(o.value.message),1)]),extra:t(()=>[r(y,{type:"primary",onClick:d[1]||(d[1]=()=>{o.value=void 0,e(V)()})},{default:t(()=>[m(g(e(a)("page.charts.error.refresh")),1)]),_:1})]),_:1},8,["title"])):(f(),h(e(ee),{key:1,class:"chart",option:p.value,loading:e(D),"loading-options":_.value,theme:e(n).isDark?"dark":"ovilia-green",autoresize:"","init-options":{renderer:"svg"}},null,8,["option","loading","loading-options","theme"]))]),_:1},8,["title"])}}}),He=I({__name:"grid",props:{downloader:{},showCharts:{}},setup(b){const{t:a}=$(),l=b,o=C(()=>l.downloader==="all"?void 0:l.downloader);return(n,_)=>{const p=De,c=xe;return f(),h(c,{justify:"center",align:"stretch",wrap:!0,gutter:[{xs:12,sm:12,md:12,lg:12,xl:24},{xs:12,sm:12,md:12,lg:12,xl:24}]},{default:t(()=>[n.showCharts.banTrends?(f(),h(p,{key:0,xl:12,lg:24,md:24,sm:24,xs:24},{default:t(()=>[r(Me,{downloader:o.value},null,8,["downloader"])]),_:1})):j("",!0),n.showCharts.fieldPie?(f(),h(p,{key:1,xl:12,lg:24,md:24,sm:24,xs:24},{default:t(()=>[r(Ne,{downloader:o.value},null,8,["downloader"])]),_:1})):j("",!0),n.showCharts.ispPie?(f(),h(p,{key:2,xl:12,lg:24,md:24,sm:24,xs:24},{default:t(()=>[r(se,{title:e(a)("page.charts.title.geoip")},{default:t(()=>[r(Fe,{downloader:o.value},null,8,["downloader"])]),_:1},8,["title"])]),_:1})):j("",!0),n.showCharts.traffic?(f(),h(p,{key:3,xl:12,lg:24,md:24,sm:24,xs:24},{default:t(()=>[r(se,{title:e(a)("page.charts.title.traffic")},{default:t(()=>[r(We,{downloader:o.value},null,8,["downloader"])]),_:1},8,["title"])]),_:1})):j("",!0),n.showCharts.trends?(f(),h(p,{key:4,xl:24,lg:24,md:24,sm:24,xs:24},{default:t(()=>[r(se,{title:e(a)("page.charts.title.trends")},{default:t(()=>[r(Ge,{downloader:o.value},null,8,["downloader"])]),_:1},8,["title"])]),_:1})):j("",!0)]),_:1})}}}),et=I({__name:"index",setup(b){const{t:a}=$(),l=Ie(),o=P(l.showCharts),{data:n}=q(be);N(o,()=>{l.setShowCharts(o.value)});const _=C(()=>{var p;return[{name:"all",title:a("page.charts.all")},...((p=n.value)==null?void 0:p.data.map(c=>({name:c.name,title:c.name})))??[]]});return(p,c)=>{const v=E,D=Ve,x=le,V=Y,i=Ce,d=Se;return f(),h(d,{"default-active-key":0,"lazy-load":"",animation:"",type:"rounded"},{extra:t(()=>[r(V,{position:"bottom"},{content:t(()=>[r(x,{direction:"vertical"},{default:t(()=>[r(D,{modelValue:o.value.banTrends,"onUpdate:modelValue":c[0]||(c[0]=s=>o.value.banTrends=s)},{default:t(()=>[m(g(e(a)("page.charts.title.line")),1)]),_:1},8,["modelValue"]),r(D,{modelValue:o.value.fieldPie,"onUpdate:modelValue":c[1]||(c[1]=s=>o.value.fieldPie=s)},{default:t(()=>[m(g(e(a)("page.charts.title.fieldPie")),1)]),_:1},8,["modelValue"]),r(D,{modelValue:o.value.ispPie,"onUpdate:modelValue":c[2]||(c[2]=s=>o.value.ispPie=s)},{default:t(()=>[m(g(e(a)("page.charts.title.geoip")),1)]),_:1},8,["modelValue"]),r(D,{modelValue:o.value.traffic,"onUpdate:modelValue":c[3]||(c[3]=s=>o.value.traffic=s)},{default:t(()=>[m(g(e(a)("page.charts.title.traffic")),1)]),_:1},8,["modelValue"]),r(D,{modelValue:o.value.trends,"onUpdate:modelValue":c[4]||(c[4]=s=>o.value.trends=s)},{default:t(()=>[m(g(e(a)("page.charts.title.trends")),1)]),_:1},8,["modelValue"])]),_:1})]),default:t(()=>[r(v,null,{default:t(()=>[m(g(e(a)("page.charts.options")),1)]),_:1})]),_:1})]),default:t(()=>[(f(!0),Ae(Le,null,Ue(_.value,(s,u)=>(f(),h(i,{key:u,title:s.title},{default:t(()=>[r(He,{downloader:s.name,"show-charts":o.value},null,8,["downloader","show-charts"])]),_:2},1032,["title"]))),128))]),_:1})}}});export{et as default};
