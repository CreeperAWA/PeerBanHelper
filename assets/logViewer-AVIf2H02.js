var $=Object.defineProperty;var G=(t,e,n)=>e in t?$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var S=(t,e,n)=>G(t,typeof e!="symbol"?e+"":e,n);import{a as W,u as B,g as z,e as F,_ as H}from"./index-B3Bc7igS.js";import{f as j,a6 as J,r as w,a as M,a8 as P,c as q,I as K,j as v,s as R,t as l,a2 as m,y as u,v as d,x as p,u as O}from"./libs-D-uoNQCp.js";import{M as k,v as Q,S as X,b as Y,T as Z,k as ee,n as te}from"./arcoDesign-CRyOpHTj.js";var _=(t=>(t.DEBUG="DEBUG",t.INFO="INFO",t.WARN="WARN",t.ERROR="ERROR",t.TRACE="TRACE",t))(_||{});class se{constructor(e,n,c){S(this,"_isOpen",!1);S(this,"ws");S(this,"url");const i=new URL(e);this.url=new URL(W(`${i.protocol==="https:"?"wss":"ws"}://${i.host}${i.pathname}`,n)),this.url.searchParams.append("token",c)}get isOpen(){return this._isOpen}get State(){var e;return((e=this.ws)==null?void 0:e.readyState)??WebSocket.CLOSED}open(e,n,c){var i;try{(i=this.ws)==null||i.close(),this.url.searchParams.append("offset",e.toString()),this.ws=new WebSocket(this.url),this.ws.onopen=()=>{this._isOpen=!0},this.ws.onerror=s=>{c(new Error(`WebSocket error: ${s}`))},this.ws.onclose=()=>{this._isOpen=!1},this.ws.onmessage=s=>{try{const f=JSON.parse(s.data);f.success?n(f.data):c(new Error(`WebSocket error: ${f.message}`))}catch{}}}catch(s){return s instanceof Error&&c(s),!1}return!0}close(){var e;this._isOpen&&((e=this.ws)==null||e.close(),this.ws=void 0)}}class ae extends se{constructor(){const e=B();super(e.endpoint,"api/logs/stream",e.authToken)}}async function oe(){const t=B();await t.serverAvailable;const e=new URL(W(t.endpoint,"api/logs/history"),location.href);return fetch(e,{headers:z()}).then(n=>(t.assertResponseLogin(n),n.json()))}const ne=j({__name:"logViewer",setup(t){const{t:e,d:n}=J(),c=w(!1),i=w(!1),s=M([]),{loading:f}=P(oe,{onSuccess:r=>{s.splice(0,s.length),s.push(...r.data)}}),N=q(()=>c.value?s.filter(r=>r.thread!=="Ban Wave"):s),T=w(),V=new ae,y=w(!1),U=async r=>{try{return r?V.open(s.length>0?s[s.length-1].offset:0,a=>{var g;s.push(a),i.value&&((g=T.value)==null||g.scrollIntoView({index:s.length-1,align:"bottom"}))},a=>{k.error(a.message),y.value=!1}):(V.close(),!0)}catch(a){return a instanceof Error&&k.error(a.message),!1}},x=r=>{switch(r){case _.TRACE:return"blue";case _.WARN:return"orange";case _.ERROR:return"red";case _.DEBUG:case _.INFO:default:return"gray"}},A=r=>r.startsWith("virtual-")||r.startsWith("pool")||/Thread-[0-9]+/.test(r)?"gray":F(r,["orange","orangered","red","blue"]);K(()=>{V.close()});const b=w(!0);return(r,a)=>{const g=Q,h=X,E=Y,C=Z,I=ee,D=te;return v(),R(h,{direction:"vertical",class:"container",size:"medium"},{default:l(()=>[m(f)?O("",!0):(v(),R(h,{key:0,size:"large"},{default:l(()=>[u(h,null,{default:l(()=>[u(g,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=o=>y.value=o),"before-change":U},null,8,["modelValue"]),d(p(m(e)("page.settings.tab.info.log.enableAutoRefresh")),1)]),_:1}),u(h,null,{default:l(()=>[u(g,{modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=o=>c.value=o)},null,8,["modelValue"]),d(p(m(e)("page.settings.tab.info.log.hideBanWave")),1)]),_:1}),u(h,null,{default:l(()=>[u(g,{modelValue:b.value,"onUpdate:modelValue":a[2]||(a[2]=o=>b.value=o)},null,8,["modelValue"]),d(p(m(e)("page.settings.tab.info.log.showThread")),1)]),_:1}),y.value?(v(),R(h,{key:0},{default:l(()=>[u(g,{modelValue:i.value,"onUpdate:modelValue":a[3]||(a[3]=o=>i.value=o)},null,8,["modelValue"]),d(p(m(e)("page.settings.tab.info.log.autoScorll")),1)]),_:1})):O("",!0)]),_:1})),u(D,{ref_key:"logList",ref:T,size:"small",loading:m(f),scrollbar:"","virtual-list-props":{height:700,buffer:20},data:N.value},{item:l(({item:o,index:L})=>[(v(),R(I,{key:L},{default:l(()=>[u(h,{class:"log-line",fill:""},{default:l(()=>[u(E,{class:"level-tag",color:x(o.level)},{default:l(()=>[d(p(o.level),1)]),_:2},1032,["color"]),u(E,null,{default:l(()=>[d(p(m(n)(o.time,"log")),1)]),_:2},1024),b.value?(v(),R(E,{key:0,color:A(o.thread)},{default:l(()=>[d(p(o.thread),1)]),_:2},1032,["color"])):O("",!0),u(C,{ellipsis:{rows:1,showTooltip:!0}},{default:l(()=>[d(p(o.content),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))]),_:1},8,["loading","data"])]),_:1})}}}),ce=H(ne,[["__scopeId","data-v-f52ee098"]]);export{ce as default};
