import{u as J,e as ue,h as he,c as Z,f as H,I as pe,b as de,_ as oe,i as ve,d as Se}from"./index-B1ZzwvYB.js";import{f as Q,c as K,j as m,k as R,n as ze,m as ke,p as X,a6 as Y,r as P,a9 as ae,q as _e,s as v,t as e,y as t,v as r,x as l,a2 as n,P as we,F as ge,u as Ce,a1 as te,w as re,ab as Le}from"./libs-Bsjl4Mfh.js";import{G as Ie,a as xe,b as He}from"./data-CjMboDzr.js";import{_ as Pe,g as $e,i as Ne,a4 as fe,S as W,T as ee,b as Te,c as se,o as le,E as Ae,O as me,ak as Me,Q as Be,j as Ke,B as je}from"./arcoDesign-Dk7yFUDg.js";import{I as be}from"./index-CvBtp9Cy.js";import{I as Fe}from"./index-BU-uc78i.js";const De=Q({name:"IconCheckCircle",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:c=>["butt","round","square"].includes(c)},strokeLinejoin:{type:String,default:"miter",validator:c=>["arcs","bevel","miter","miter-clip","round"].includes(c)},rotate:Number,spin:Boolean},emits:{click:c=>!0},setup(c,{emit:d}){const i=$e("icon"),s=K(()=>[i,`${i}-check-circle`,{[`${i}-spin`]:c.spin}]),y=K(()=>{const p={};return c.size&&(p.fontSize=Ne(c.size)?`${c.size}px`:c.size),c.rotate&&(p.transform=`rotate(${c.rotate}deg)`),p});return{cls:s,innerStyle:y,onClick:p=>{d("click",p)}}}}),Ue=["stroke-width","stroke-linecap","stroke-linejoin"],Ee=X("path",{d:"m15 22 7 7 11.5-11.5M42 24c0 9.941-8.059 18-18 18S6 33.941 6 24 14.059 6 24 6s18 8.059 18 18Z"},null,-1),Ge=[Ee];function Oe(c,d,i,s,y,b){return m(),R("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:ze(c.cls),style:ke(c.innerStyle),"stroke-width":c.strokeWidth,"stroke-linecap":c.strokeLinecap,"stroke-linejoin":c.strokeLinejoin,onClick:d[0]||(d[0]=(...p)=>c.onClick&&c.onClick(...p))},Ge,14,Ue)}var ne=Pe(De,[["render",Oe]]);const Ve=Object.assign(ne,{install:(c,d)=>{var i;const s=(i=d==null?void 0:d.iconPrefix)!=null?i:"";c.component(s+ne.name,ne)}}),qe=Q({__name:"accessHistoryModal",setup(c,{expose:d}){const{t:i,d:s}=Y(),y=J(),b=P(!1),p=P("");d({showModal:(a,g)=>{p.value=g,U({page:1,pageSize:10,infoHash:a}),b.value=!0}});const{data:$,total:k,current:j,loading:N,pageSize:F,changeCurrent:T,changePageSize:D,runAsync:U}=ae(Ie,{pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},manual:!0,cacheKey:a=>`${y.endpoint}-torrentAccessHistory-${a==null?void 0:a[0].infoHash}-${(a==null?void 0:a[0].page)||1}-${(a==null?void 0:a[0].pageSize)||10}`}),A=[{title:"ID",dataIndex:"id"},{title:()=>i("page.torrentList.accessHistory.column.downloader"),slotName:"downloader"},{title:()=>i("page.torrentList.accessHistory.column.address"),slotName:"address"},{title:"Peer ID",slotName:"peerId"},{title:()=>i("page.torrentList.accessHistory.column.traffic"),slotName:"traffic"},{title:()=>te(W,[i("page.torrentList.accessHistory.column.offset"),te(fe,{content:i("page.torrentList.accessHistory.column.offsetDescription")},()=>te(Z))]),slotName:"offset"},{title:"Flags",slotName:"flags"},{title:()=>i("page.torrentList.accessHistory.column.timeseen"),slotName:"time"}],M=a=>a.split(" ").map(g=>g+" - "+i("page.dashboard.peerList.column.flags."+g.trim()));return(a,g)=>{const E=_e("i18n-t"),u=ee,_=Te,C=se,S=pe,z=de,h=W,B=le,L=Ae,G=me;return m(),v(G,{visible:b.value,"onUpdate:visible":g[0]||(g[0]=w=>b.value=w),"hide-cancel":"",closable:"","unmount-on-close":"",width:"auto"},{title:e(()=>[t(E,{keypath:"page.torrentList.accessHistory.title"},{name:e(()=>[r(l(p.value),1)]),_:1})]),default:e(()=>[t(h,{direction:"vertical",fill:""},{default:e(()=>{var w,I;return[t(u,{style:{"font-size":"1.2em"}},{default:e(()=>[r(l(n(i)("page.torrentList.accessHistory.description")),1)]),_:1}),(w=n($))!=null&&w.data.results||n(N)?(m(),v(B,{key:0,stripe:!0,columns:A,data:(I=n($))==null?void 0:I.data.results,loading:n(N),pagination:{total:n(k),current:n(j),pageSize:n(F),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onPageChange:n(T),onPageSizeChange:n(D)},{address:e(({record:o})=>[t(u,{code:"",copyable:"",style:{"white-space":"nowrap"}},{default:e(()=>[t(ue,{ip:o.address,style:{color:"var(--color-text-2)"}},{default:e(()=>[r(l(o.address),1)]),_:2},1032,["ip"])]),_:2},1024)]),downloader:e(({record:o})=>[t(_,{color:n(he)(o.downloader)},{default:e(()=>[r(l(o.downloader),1)]),_:2},1032,["color"])]),peerId:e(({record:o})=>[X("p",null,[r(l(o.peerId?o.peerId:n(i)("page.banlist.banlist.listItem.empty"))+" ",1),t(C,{content:o.clientName?o.clientName:n(i)("page.banlist.banlist.listItem.empty")},{default:e(()=>[t(n(Z))]),_:2},1032,["content"])])]),traffic:e(({record:o})=>[t(h,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[t(S,{class:"green"}),r(" "+l(n(H)(o.uploaded)),1)]),_:2},1024),t(u,null,{default:e(()=>[t(z,{class:"red"}),r(" "+l(n(H)(o.downloaded)),1)]),_:2},1024)]),_:2},1024)]),offset:e(({record:o})=>[t(h,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[t(S,{class:"green"}),r(" "+l(n(H)(o.uploadedOffset)),1)]),_:2},1024),t(u,null,{default:e(()=>[t(z,{class:"red"}),r(" "+l(n(H)(o.downloadedOffset)),1)]),_:2},1024)]),_:2},1024)]),flags:e(({record:o})=>[X("p",null,[r(l(o.lastFlags)+" ",1),o.lastFlags?(m(),v(C,{key:0},{content:e(()=>[(m(!0),R(ge,null,we(M(o.lastFlags),O=>(m(),R("p",{key:O},l(O),1))),128))]),default:e(()=>[t(n(Z))]),_:2},1024)):Ce("",!0)])]),time:e(({record:o})=>[t(h,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[r(l(n(i)("page.torrentList.accessHistory.column.timeseen.first"))+": "+l(n(s)(o.firstTimeSeen,"long")),1)]),_:2},1024),t(u,null,{default:e(()=>[r(l(n(i)("page.torrentList.accessHistory.column.timeseen.last"))+": "+l(n(s)(o.lastTimeSeen,"long")),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])):(m(),v(L,{key:1,style:{height:"20vh","align-items":"center",display:"flex","justify-content":"center","flex-direction":"column"}},{default:e(()=>[r(l(n(i)("page.torrentList.accessHistory.empty")),1)]),_:1}))]}),_:1})]),_:1},8,["visible"])}}}),We=oe(qe,[["__scopeId","data-v-6076a53d"]]),Qe=Q({__name:"banHistoryModal",setup(c,{expose:d}){const i=J(),{t:s,d:y}=Y(),b=P(!1),p=P("");d({showModal:(a,g)=>{p.value=g,U({page:1,pageSize:10,infoHash:a}),b.value=!0}});const{data:$,total:k,current:j,loading:N,pageSize:F,changeCurrent:T,changePageSize:D,runAsync:U}=ae(xe,{manual:!0,pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:a=>`${i.endpoint}-torrentBanHistory-${a==null?void 0:a[0].infoHash}-${(a==null?void 0:a[0].page)||1}-${(a==null?void 0:a[0].pageSize)||10}`}),A=[{title:()=>s("page.banlog.banlogTable.column.banTime")+"/"+s("page.banlog.banlogTable.column.unbanTime"),slotName:"banAt",width:210},{title:()=>s("page.banlog.banlogTable.column.peerAddress"),slotName:"peerAddress",width:200},{title:()=>s("page.banlog.banlogTable.column.peerId"),slotName:"peerId",width:120},{title:()=>s("page.banlog.banlogTable.column.trafficSnapshot"),slotName:"peerStatus",width:150},{title:()=>s("page.banlog.banlogTable.column.description"),dataIndex:"description",ellipsis:!0,tooltip:!0}],M=K(()=>{var a;return(a=$.value)==null?void 0:a.data.results});return(a,g)=>{const E=_e("i18n-t"),u=ee,_=be,C=Me,S=W,z=pe,h=de,B=Be,L=se,G=Z,w=le,I=me;return m(),v(I,{visible:b.value,"onUpdate:visible":g[0]||(g[0]=o=>b.value=o),"hide-cancel":"",closable:"","unmount-on-close":"",width:"auto"},{title:e(()=>[t(E,{keypath:"page.torrentList.banHistory.title"},{name:e(()=>[r(l(p.value),1)]),_:1})]),default:e(()=>[t(S,{direction:"vertical",fill:"",style:{"max-width":"1400px"}},{default:e(()=>[t(u,{style:{"font-size":"1.2em"}},{default:e(()=>[r(l(n(s)("page.torrentList.banHistory.description")),1)]),_:1}),t(w,{stripe:!0,columns:A,data:M.value,loading:n(N),pagination:{total:n(k),current:n(j),pageSize:n(F),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",onPageChange:n(T),onPageSizeChange:n(D)},{banAt:e(({record:o})=>[t(S,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[t(_),r(" "+l(n(y)(o.banAt,"long")),1)]),_:2},1024),t(u,null,{default:e(()=>[t(C),r(" "+l(o.unbanAt?n(y)(o.unbanAt,"long"):n(s)("page.banlog.banlogTable.notUnbanned")),1)]),_:2},1024)]),_:2},1024)]),peerAddress:e(({record:o})=>[t(u,{code:""},{default:e(()=>[t(ue,{ip:o.peerIp,style:{color:"var(--color-text-2)"}},{default:e(()=>[r(l(o.peerIp)+":"+l(o.peerPort),1)]),_:2},1032,["ip"])]),_:2},1024)]),peerStatus:e(({record:o})=>[t(S,{fill:"",style:{"justify-content":"space-between"}},{default:e(()=>[t(S,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[t(z,{class:"green"}),r(" "+l(n(H)(o.peerUploaded)),1)]),_:2},1024),t(u,null,{default:e(()=>[t(h,{class:"red"}),r(" "+l(n(H)(o.peerDownloaded)),1)]),_:2},1024)]),_:2},1024),t(L,{content:(o.peerProgress*100).toFixed(2)+"%"},{default:e(()=>[t(B,{percent:o.peerProgress,size:"mini"},null,8,["percent"])]),_:2},1032,["content"])]),_:2},1024)]),peerId:e(({record:o})=>[X("p",null,[r(l(o.peerId?o.peerId:n(s)("page.banlist.banlist.listItem.empty"))+" ",1),t(L,{content:o.peerClientName?o.peerClientName:n(s)("page.banlist.banlist.listItem.empty")},{default:e(()=>[t(G)]),_:2},1032,["content"])])]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])]),_:1})]),_:1},8,["visible"])}}}),Ze=oe(Qe,[["__scopeId","data-v-4b8de521"]]),Je=Q({__name:"torrentTable",setup(c){const d=P(!0),i=J(),{t:s}=Y(),{data:y,total:b,current:p,loading:$,pageSize:k,changeCurrent:j,changePageSize:N,refresh:F,run:T}=ae(He,{defaultParams:[{page:1,pageSize:10}],pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:_=>`${i.endpoint}-torrentInfoList-${(_==null?void 0:_[0].page)||1}-${(_==null?void 0:_[0].pageSize)||10}`,onAfter:()=>{d.value=!1}},[Se]);re([k,p],()=>{d.value=!0}),re(()=>i.endpoint,F);const D=K(()=>d.value||$.value||!A.value),U=[{title:()=>s("page.torrentList.column.name"),dataIndex:"name",ellipsis:!0,tooltip:!0,width:500},{title:"Hash",slotName:"hash",width:340},{title:()=>s("page.torrentList.column.size"),slotName:"size",width:120},{title:()=>s("page.torrentList.column.count"),slotName:"count"},{title:()=>s("page.torrentList.column.actions"),slotName:"action"}],A=K(()=>{var _;return(_=y.value)==null?void 0:_.data.results}),M=P(),a=P(),g=Le.debounce(_=>{T({page:p.value,pageSize:k.value,keyword:_})},300),E=J(),u=K(()=>E.plusStatus);return(_,C)=>{const S=Ke,z=W,h=ee,B=be,L=fe,G=Ve,w=ve,I=Fe,o=je,O=se,ye=le;return m(),R(ge,null,[t(z,{direction:"vertical",fill:""},{default:e(()=>[t(z,{class:"align-right",fill:""},{default:e(()=>[t(S,{style:{width:"250px"},placeholder:n(s)("page.torrentList.accessHistory.searchPlaceholder"),"allow-clear":"","search-button":"",onSearch:n(g),onChange:n(g),onClear:C[0]||(C[0]=f=>n(T)({page:n(p),pageSize:n(k)}))},null,8,["placeholder","onSearch","onChange"])]),_:1}),t(ye,{stripe:!0,columns:U,data:A.value,loading:D.value,pagination:{total:n(b),current:n(p),pageSize:n(k),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onPageChange:n(j),onPageSizeChange:n(N)},{size:e(({record:f})=>[r(l(n(H)(f.size)),1)]),hash:e(({record:f})=>[t(h,{code:"",style:{"white-space":"nowrap"}},{default:e(()=>[r(l(f.infoHash),1)]),_:2},1024)]),count:e(({record:f})=>[t(z,{fill:"",direction:"vertical"},{default:e(()=>[t(L,{content:`${n(s)("page.torrentList.column.count.ban")}: ${f.peerBanCount}`},{default:e(()=>[t(h,null,{default:e(()=>[t(B),r(" "+l(f.peerBanCount),1)]),_:2},1024)]),_:2},1032,["content"]),t(L,{content:`${n(s)("page.torrentList.column.count.access")}: ${f.peerAccessCount}`},{default:e(()=>[t(h,null,{default:e(()=>[t(G),r(" "+l(f.peerAccessCount),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),action:e(({record:f})=>[t(z,{wrap:""},{default:e(()=>{var ie,ce;return[t(O,{content:(ie=u.value)!=null&&ie.activated?n(s)("page.torrentList.column.actions.history"):n(s)("page.ipList.plusLock"),position:"top",mini:""},{default:e(()=>{var V;return[t(o,{class:"edit-btn",shape:"circle",type:"text",disabled:!((V=u.value)!=null&&V.activated),onClick:x=>{var q;return(q=M.value)==null?void 0:q.showModal(f.infoHash,f.name)}},{icon:e(()=>{var x;return[(x=u.value)!=null&&x.activated?(m(),v(w,{key:0})):(m(),v(I,{key:1}))]}),_:2},1032,["disabled","onClick"])]}),_:2},1032,["content"]),t(O,{content:(ce=u.value)!=null&&ce.activated?n(s)("page.torrentList.column.actions.ban"):n(s)("page.ipList.plusLock"),position:"top",mini:""},{default:e(()=>{var V;return[t(o,{class:"edit-btn",shape:"circle",type:"text",disabled:!((V=u.value)!=null&&V.activated),onClick:x=>{var q;return(q=a.value)==null?void 0:q.showModal(f.infoHash,f.name)}},{icon:e(()=>{var x;return[(x=u.value)!=null&&x.activated?(m(),v(B,{key:0})):(m(),v(I,{key:1}))]}),_:2},1032,["disabled","onClick"])]}),_:2},1032,["content"])]}),_:2},1024)]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])]),_:1}),t(We,{ref_key:"accessHistoryModal",ref:M},null,512),t(Ze,{ref_key:"banHistoryModal",ref:a},null,512)],64)}}}),Re=oe(Je,[["__scopeId","data-v-fdc02bbf"]]),at=Q({__name:"index",setup(c){const{t:d}=Y();return(i,s)=>{const y=ee,b=W;return m(),v(b,{direction:"vertical",fill:""},{default:e(()=>[t(y,{style:{"font-size":"1.2em"}},{default:e(()=>[r(l(n(d)("page.torrentList.description")),1)]),_:1}),t(Re)]),_:1})}}});export{at as default};
